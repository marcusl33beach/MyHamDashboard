<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyHamDashboard</title>
    <style>
        /* =============================
        1. GLOBAL LAYOUT STYLES 
        =============================
        */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%; /* Forces full viewport height */
            overflow: hidden; /* Prevents scrollbars on the main page */
            font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #1a1a1a; 
            color: #f0f0f0;
        }

        #page-container {
            display: flex;
            flex-direction: column;
            height: 100vh; 
            position: relative;
        }

        /* =============================
        2. GRID SYSTEM (4x3 Layout)
        =============================
        */
        #grid-container {
            flex-grow: 1; /* Takes up all space not used by the ticker */
            display: grid;
            /* Creates 4 equal columns */
            grid-template-columns: repeat(4, 1fr);
            /* Creates 3 equal rows */
            grid-template-rows: repeat(3, 1fr);
            width: 100%;
            height: 100%;
            overflow: hidden; 
        }

        .grid-item {
            width: 100%;
            height: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1); /* Subtle grid lines */
            box-sizing: border-box; 
            background-color: #000;
            overflow: hidden; 
            position: relative;
        }

        /* =============================
        3. CONTENT STYLING (Images/Video)
        =============================
        */
        .grid-item img, 
        .grid-item video,
        .grid-item iframe { 
            width: 100%;
            height: 100%;
            display: block;
            border: none;
            /* 'cover' ensures the image fills the box without stretching (may crop edges) */
            object-fit: cover; 
        }

        /* Special rules for specific content types */
        .grid-item iframe { object-fit: fill; }
        /* Class to prevent cropping on text-heavy images */
        .grid-item img.contain-fit { object-fit: contain; }

        /* =============================
        4. BOTTOM TICKER & MENU BAR
        =============================
        */
        #ticker-wrap {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30px; 
            background-color: rgba(0, 0, 0, 0.75); /* Transparent Black */
            border-top: 1px solid #555;
            overflow: visible; /* Allows the menu to pop UP out of the box */
            white-space: nowrap;
            z-index: 9999; /* Ensures it sits on top of images */
            display: flex;
            align-items: center;
            backdrop-filter: blur(5px); /* Blurs the image behind the bar */
        }

        /* The "Menu" Button Styles */
        #ticker-title {
            background-color: rgba(0, 0, 0, 0.75); 
            color: white;
            padding: 0 15px;
            height: 100%;
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 0.85em; 
            z-index: 10;
            border-right: 1px solid #555; 
            cursor: pointer; 
            position: relative; 
            transition: background-color 0.3s;
        }

        #ticker-title:hover {
            background-color: #333; 
        }

        /* =============================
        5. POPUP DROPDOWN MENU
        =============================
        */
        .dropdown-content {
            display: none; /* Hidden by default */
            position: absolute;
            bottom: 30px; /* Positions it exactly above the bar */
            left: 0;
            background-color: rgba(0, 0, 0, 0.9);
            min-width: 200px;
            box-shadow: 0px -4px 16px rgba(0,0,0,0.5);
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            overflow: hidden;
            border: 1px solid #444;
            border-bottom: none;
            backdrop-filter: blur(5px);
        }

        /* Menu Links */
        .dropdown-content a {
            color: #f0f0f0;
            padding: 10px 16px;
            text-decoration: none;
            display: block;
            font-size: 0.9em;
            border-bottom: 1px solid #333;
            transition: background 0.2s;
        }

        .dropdown-content a:hover {
            background-color: #b00; /* Red highlight */
        }

        /* CSS Magic: Show menu when hovering over the title */
        #ticker-title:hover .dropdown-content {
            display: block;
        }

        /* =============================
        6. SCROLLING ANIMATION
        =============================
        */
        #ticker-move {
            display: inline-block;
            padding-left: 100%; /* Start off-screen */
            /* Adjust '30s' to make the scroll faster or slower */
            animation: scroll-left 30s linear infinite;
            color: #fff;
            font-size: 0.95em; 
            font-weight: 500;
            line-height: 30px; 
        }

        @keyframes scroll-left {
            0%   { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
    </style>
</head>
<body>

    <div id="page-container">
        <main id="grid-container"></main>
        
        <div id="ticker-wrap">
            <div id="ticker-title">
                Menu &#9650; 
                
                <div class="dropdown-content">
                    <a href="https://www.weather.gov/" target="_blank">NWS Home</a>
                    <a href="https://mygmrs.com/" target="_blank">MyGMRS</a>
                    <a href="https://www.qrz.com/" target="_blank">QRZ.com</a>
                    
                    <a href="https://www.radioreference.com/db/browse/stid/21" target="_blank">RadioReference KY</a>
                    <a href="https://www.repeaterbook.com/repeaters/index.php?state_id=21" target="_blank">RepeaterBook KY</a>
                    
                    <a href="javascript:location.reload()">Refresh Dashboard</a>
                </div>
            </div>

            <div id="ticker-move" id="ticker-content">Loading Weather Data...</div>
        </div>
    </div>

    <script>
        /* ========================================================================
        CONFIGURATION: DASHBOARD CONTENT
        12 URLs that populate the 4x3 grid.
        - Ends in .mp4 -> Renders as <video>
        - Contains 'solarpic' -> Renders as <img> (Specific for HamQSL)
        - All others -> Render as <img>
        ========================================================================
        */
        const contentUrls = [
            // ROW 1
            'https://radar.weather.gov/ridge/standard/CONUS_loop.gif', 
            'https://graphical.weather.gov/images/conus/T1_conus.png', // Temperature Map
            'https://services.swpc.noaa.gov/images/animations/d-rap/global/d-rap/latest.png', 
            'https://services.swpc.noaa.gov/images/swx-overview-large.gif', 
            
            // ROW 2
            'https://cdn.star.nesdis.noaa.gov/GOES16/GLM/SECTOR/can/EXTENT3/GOES16-CAN-EXTENT3-1125x560.gif', 
            'https://cdn.star.nesdis.noaa.gov/GOES16/GLM/SECTOR/cgl/EXTENT3/GOES16-CGL-EXTENT3-600x600.gif', 
            'https://services.swpc.noaa.gov/experimental/images/aurora_dashboard/tonights_static_viewline_forecast.png', 
            'https://www.blitzortung.org/en/Images/image_b_ny.png', 
            
            // ROW 3
            'https://www.trimarc.org/images/milestone/CCTV_06_275_0089.jpg', 
            'https://cdn.star.nesdis.noaa.gov/GOES16/ABI/SECTOR/can/13/GOES16-CAN-13-1125x560.gif', 
            'https://himawari8.nict.go.jp/movie/720/20240611_pifd.mp4',
            'https://www.hamqsl.com/solar101vhfpic.php' // Direct image generator link
        ];

        /* ========================================================================
        LOGIC: GRID BUILDER
        Iterates through the URLs and creates the HTML elements
        ========================================================================
        */
        function getContentType(url) {
            const lowerUrl = url.toLowerCase();
            if (lowerUrl.endsWith('.mp4')) return 'video';
            if (lowerUrl.includes('solarpic') || lowerUrl.includes('solar101vhfpic')) return 'img';
            return 'img'; 
        }

        const gridContainer = document.getElementById('grid-container');

        function buildGrid() {
            contentUrls.forEach(url => {
                const contentType = getContentType(url);
                const gridItem = document.createElement('div');
                gridItem.classList.add('grid-item');

                let el;
                if (contentType === 'video') {
                    el = document.createElement('video');
                    el.src = url;
                    el.autoplay = true; el.loop = true; el.muted = true; el.controls = false;
                } else {
                    el = document.createElement('img');
                    el.src = url;
                    // Special handling for HamQSL to prevent cropping text
                    if(url.includes('hamqsl')) el.classList.add('contain-fit'); 
                    // Hide image if link is broken
                    el.onerror = function() { this.style.display='none'; }; 
                }
                
                gridItem.appendChild(el);
                gridContainer.appendChild(gridItem);
            });
        }

        /* ========================================================================
        LOGIC: WEATHER TICKER
        Fetches NWS CAP Alerts via rss2json proxy.
        Customize the RSS_URL variable for different zones.
        Zone ID: KYZ091 (Boone County, KY)
        ========================================================================
        */
        const RSS_URL = "https://alerts.weather.gov/cap/wwaatmget.php?x=KYZ091&y=0&a=0";
        // Using public proxy to avoid CORS errors when running locally
        const API_URL = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(RSS_URL);

        function updateTicker() {
            const ticker = document.getElementById('ticker-move');
            
            fetch(API_URL)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok' && data.items.length > 0) {
                    // WE HAVE ACTIVE ALERTS
                    let alertText = "";
                    data.items.forEach(item => {
                        alertText += " ⚠️ " + item.title + " ";
                    });
                    ticker.innerText = alertText + " (Source: NWS) ";
                } else {
                    // NO ACTIVE ALERTS - Generic Message
                    ticker.innerText = "NO ACTIVE WEATHER ALERTS FOR BOONE COUNTY, KY";
                }
            })
            .catch(error => {
                console.error("Ticker Error:", error);
                ticker.innerText = "Weather Data Unavailable (Check Internet Connection)";
            });
        }

        // Initialize functionality when page loads
        document.addEventListener('DOMContentLoaded', () => {
            buildGrid();
            updateTicker();
            // Update ticker every 15 minutes (900,000 ms)
            setInterval(updateTicker, 900000);
        });
    </script>
</body>
</html>